name: data
on:
  schedule:
    - cron: "*/30 * * * *"
  workflow_dispatch: {}
  push:
    paths:
      - .github/workflows/flat.yml
      - ./postprocess.ts
jobs:
  scheduled:
    runs-on: ubuntu-latest
    steps:
      - name: Setup deno
        uses: denoland/setup-deno@main
        with:
          deno-version: v1.x
      - name: Check out repo
        uses: actions/checkout@v2

      - name: rude_golems - Fetch Magic Eden data
        uses: githubocto/flat@v3
        with:
          http_url: https://api-mainnet.magiceden.io/rpc/getListedNFTsByQuery?q=%7B%22%24match%22%3A%7B%22collectionSymbol%22%3A%22rude_golems%22%7D%2C%22%24sort%22%3A%7B%22takerAmount%22%3A1%2C%22createdAt%22%3A-1%7D%2C%22%24skip%22%3A0%2C%22%24limit%22%3A500%7D
          downloaded_filename: rude_golems__magiceden.json
          postprocess: ./postprocess/magiceden.ts

      - name: rude_golems - Fetch Solanart data
        uses: githubocto/flat@v3
        with:
          http_url: https://qzlsklfacc.medianetwork.cloud/get_nft?collection=rudegolems&page=0&limit=100&order=price-ASC&fits=any&trait=&search=&min=0&max=0&listed=true&ownedby=&attrib_count=&bid=all
          downloaded_filename: rude_golems__solanart.json
          postprocess: ./postprocess/solanart.ts